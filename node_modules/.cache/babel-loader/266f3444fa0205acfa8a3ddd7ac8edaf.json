{"ast":null,"code":"var _jsxFileName = \"/Users/daviribeiro/Desktop/projetos FDTE/projetos/transcender-jitsi/src/pages/celebracao/sala/sala.js\";\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport $, { map } from \"jquery\";\nimport { Button, IcoCamera, IcoMicrofone, IcoSemCamera, IcoSemMicrofone, IcoTelefone } from \"../../../components\";\nimport { Assento } from \"./assento\";\nimport { AssentoMeu } from \"./assentoMeu\";\nimport { AssentoMemorial } from \"./assentoMemorial\";\nimport { history } from \"../../../utils/helpers\";\nimport { useParams } from \"react-router-dom\";\nimport { atualisaCampo } from \"../redux/CelebracaoActions\";\nimport './sala.css'; // Lib-jitsi-meet requires jquery as global object\n\nwindow.$ = $;\n\nfunction App() {\n  const dispath = useDispatch();\n  const videoConferenciaState = useSelector(state => state.celebracaoState.videoConferencia);\n  const paramsUrl = useParams();\n  useEffect(() => {\n    if (paramsUrl.sala) {\n      const target = {\n        target: {\n          name: 'sala',\n          value: paramsUrl.sala\n        }\n      };\n      dispath(atualisaCampo(target));\n    }\n  }, [paramsUrl]);\n  const [error, setError] = useState(null);\n  const [msgs, setMsgs] = useState([]);\n  const [members, setMembers] = useState([]);\n  const [remoteTracks, setRemoteTracks] = useState([]);\n  const [permissionDenied, setPermissionDenied] = useState(null);\n  const [isAudioMuted, setIsAudioMuted] = useState(false);\n  const [isVideoMuted, setIsVideoMuted] = useState(false);\n  const videoElement = useRef(null);\n  const connection = useRef(null);\n  const conferenceRoom = useRef(null);\n  const ROOM_NAME = videoConferenciaState.sala;\n  const DISPLAY_NAME = videoConferenciaState.nome ? videoConferenciaState.nome : \"Participante - \" + Math.floor(Date.now() / 1000);\n  const memorialInfo = {\n    nome: videoConferenciaState.nomeHomenageado,\n    data: `${videoConferenciaState.dataNascimento} - ${videoConferenciaState.dataFalecimento} `,\n    descricao: videoConferenciaState.epitafio,\n    img: 'https://www.hojeemdia.com.br/polopoly_fs/1.648481.1534536791!/image/image.jpg_gen/derivatives/landscape_653/image.jpg'\n  };\n  useEffect(() => {\n    if (!window.JitsiMeetJS) {\n      setError(\"JitsiMeetJS is not available. Please check if lib-jitsi-meet is included in index.html file\");\n      return;\n    }\n\n    if (!window.config) {\n      setError(\"Video conference config is not available. Please check if config.js is included in index.html file\");\n      return;\n    }\n\n    const {\n      JitsiMeetJS,\n      config\n    } = initializeJitsiMeetJS();\n    initializeConnection(JitsiMeetJS, config);\n    return; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  function initializeJitsiMeetJS() {\n    const {\n      JitsiMeetJS,\n      config\n    } = window;\n    let serviceUrl = 'wss://meet.jit.si/xmpp-websocket'; //config.websocket || config.bosh;\n\n    serviceUrl += `?room=${ROOM_NAME}`;\n    config.serviceUrl = config.bosh = serviceUrl;\n    const initOptions = {\n      disableAudioLevels: true\n    }; // Jitsi will show logs as errors\n\n    JitsiMeetJS.setLogLevel(JitsiMeetJS.logLevels.ERROR);\n    JitsiMeetJS.init(initOptions);\n    return {\n      JitsiMeetJS,\n      config\n    };\n  }\n\n  function initializeConnection(JitsiMeetJS, config) {\n    connection.current = new JitsiMeetJS.JitsiConnection(null, null, config);\n    setupConnectionListeners(JitsiMeetJS);\n    addMsg(\"Connecting to video conference server...\");\n    connection.current.connect();\n  }\n\n  function setupConnectionListeners(JitsiMeetJS) {\n    connection.current.addEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED, handleConnectionEstablished);\n    connection.current.addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED, handleConnectionFailure);\n    connection.current.addEventListener(JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED, handleConnectionDisconnected);\n  }\n\n  function handleConnectionEstablished() {\n    setMsgs([\"Connection successful\"]);\n    initConferenceRoom();\n  }\n\n  function initConferenceRoom() {\n    const {\n      JitsiMeetJS\n    } = window;\n    setupJitsiConference();\n    setupConferenceHandlers(JitsiMeetJS);\n    setupErrorHandlers(JitsiMeetJS);\n    setMsgs([`Joining conference room ${ROOM_NAME}`]);\n    conferenceRoom.current.setDisplayName(DISPLAY_NAME);\n    conferenceRoom.current.join();\n  }\n\n  function setupJitsiConference() {\n    const confOptions = {\n      openBridgeChannel: true\n    };\n    conferenceRoom.current = connection.current.initJitsiConference(ROOM_NAME, confOptions);\n  }\n\n  function setupConferenceHandlers(JitsiMeetJS) {\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.CONFERENCE_JOINED, handleConferenceJoined);\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.USER_JOINED, handleUserJoined);\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.USER_LEFT, handleUserLeft);\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.TRACK_ADDED, handleTrackAdded);\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.TRACK_REMOVED, handleTrackRemoved);\n  }\n\n  async function handleConferenceJoined() {\n    setMsgs([`Joined conference room ${ROOM_NAME}`]);\n    const {\n      JitsiMeetJS\n    } = window;\n\n    try {\n      const tracks = await JitsiMeetJS.createLocalTracks({\n        devices: [\"audio\", \"video\"],\n        resolution: \"vga\"\n      });\n      setPermissionDenied(false);\n      if (tracks.length === 0) return;\n\n      for (let i = 0; i < tracks.length; i++) {\n        if (tracks[i].getType() === \"video\") tracks[i].attach(videoElement.current);\n        conferenceRoom.current.addTrack(tracks[i]);\n      }\n    } catch (err) {\n      if (err.name === \"gum.not_found\") {\n        try {\n          const tracks = await JitsiMeetJS.createLocalTracks({\n            devices: [\"audio\"]\n          });\n          setPermissionDenied(false);\n          if (tracks.length === 0) return;\n\n          for (let i = 0; i < tracks.length; i++) {\n            if (tracks[i].getType() === \"video\") tracks[i].attach(videoElement.current);\n            conferenceRoom.current.addTrack(tracks[i]);\n          }\n        } catch (e) {\n          console.log(e);\n        }\n      }\n\n      console.log(err);\n    }\n  }\n\n  function handleUserJoined(memberId) {// if (members[memberId]) return;\n    // const displayName = conferenceRoom.current.getParticipantById(memberId)\n    //   ._displayName;\n    // createAndAddMember(memberId, displayName);\n  }\n\n  function handleUserLeft(memberId) {\n    console.log(\"[TRACKS BEFORE REMOVING]\", remoteTracks); // let tracks = remoteTracks.filter((t) => {\n    //   console.log(t);\n    //   return t.getParticipantId() !== memberId;\n    // });\n    // console.log(\"[TRACKS AFTER REMOVING]\", tracks);\n    // setRemoteTracks(tracks);\n\n    document.getElementById(`member-${memberId}`).remove(); // removeMember(memberId);\n  }\n\n  function handleTrackAdded(track) {\n    if (track.isLocal()) return;\n    setRemoteTracks(prev => [...prev, track]);\n  }\n\n  function handleTrackRemoved(track) {\n    setRemoteTracks(prev => {\n      const t = prev.filter(p => p.getId() !== track.getId());\n      return t;\n    });\n  }\n\n  const sjustListMember = (i, t) => {\n    const mx = members.filter(m => m.id === i);\n\n    if (mx.length) {\n      const j = members.map(m => m.id === i ? { ...m,\n        [t.getType()]: t\n      } : m);\n      setMembers(j);\n    } else {\n      const name = conferenceRoom.current.participants[i]['_displayName'] ? conferenceRoom.current.participants[i]['_displayName'] : `Participante - ${i}`;\n      setMembers([...members, {\n        id: i,\n        name,\n        [t.getType()]: t\n      }]);\n    }\n  };\n\n  useEffect(() => {\n    for (let i = 0; i < remoteTracks.length; i++) {\n      const track = remoteTracks[i];\n      const id = track.getParticipantId();\n      sjustListMember(id, track);\n    }\n  }, [remoteTracks]);\n\n  function setupErrorHandlers(JitsiMeetJS) {\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.CONNECTION_ERROR, () => {\n      setMsgs([]);\n      setError(\"Conference room connection error\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.SETUP_FAILED, () => {\n      setMsgs([]);\n      setError(\"Conference room set up failed\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.VIDEOBRIDGE_NOT_AVAILABLE, () => {\n      setMsgs([]);\n      setError(\"Conference room video bridge not available\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.RESERVATION_ERROR, () => {\n      setMsgs([]);\n      setError(\"Conference room reservation error\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.AUTHENTICATION_REQUIRED, () => {\n      setError(\"Conference room creation failed as authentication is required\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.JINGLE_FATAL_ERROR, err => {\n      setMsgs([]);\n      setError(\"Conference room creation failed due to jingle error\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.PASSWORD_REQUIRED, () => {\n      setMsgs([]);\n      setError(\"Conference room join failed as password was required\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.FOCUS_DISCONNECTED, () => {\n      setMsgs([]);\n      setError(\"Conference room focus disconnected\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.CONFERENCE_ERROR, () => {\n      setMsgs([]);\n      setError(\"Conference room error\");\n    });\n    conferenceRoom.current.on(JitsiMeetJS.events.conference.CONFERENCE_FAILED, () => {\n      setMsgs([]);\n      setError(\"Conference room create/join failed\");\n    });\n  }\n\n  function handleConnectionFailure() {\n    setMsgs([\"Connection failure\"]);\n  }\n\n  function handleConnectionDisconnected() {\n    addMsg(\"Disconnected\");\n  } // UI interactions and updates\n\n\n  function addMsg(msg) {\n    setMsgs(prevMsgs => [...prevMsgs, msg]);\n  }\n\n  function toggleAudio() {\n    const tracks = conferenceRoom.current.getLocalTracks();\n    tracks.forEach(track => {\n      if (track.getType() === \"audio\") {\n        setIsAudioMuted(!track.isMuted());\n        track.isMuted() ? track.unmute() : track.mute();\n      }\n    });\n  }\n\n  function toggleVideo() {\n    const tracks = conferenceRoom.current.getLocalTracks();\n    tracks.forEach(track => {\n      if (track.getType() === \"video\") {\n        setIsVideoMuted(!track.isMuted());\n        track.isMuted() ? track.unmute() : track.mute();\n      }\n    });\n  }\n\n  const sairSala = () => {\n    connection.current.disconnect();\n    history.push('/sala');\n  }; // const membersTest = () =>{\n  //   const Assento = [0, 1, 2, 3, 4],\n  //   lengthAssento = Assento.length\n  //   const davi = Assento.map((i)=>{\n  //     const seatSize = getWidthForSeats(lengthAssento);\n  //     const disanceRatio = getDistanceRatioForSeats(lengthAssento);\n  //     let index = i \n  //     const angle = (360 / lengthAssento) * index;\n  //     const horizontal = Math.cos(angle * 2 * Math.PI / 360) * disanceRatio;\n  //     const vertical = Math.sin(angle * 2 * Math.PI / 360) * disanceRatio;\n  // let style = { \n  //   width: seatSize, \n  //   height: seatSize, \n  //   top: `calc(50% - ${seatSize}px/2  + ${vertical}%)`, \n  //   left: `calc(50% - ${seatSize}px/2 + ${horizontal}%)`,\n  // }\n  //     return <div \n  //     className={'assento'} \n  //     id={`member-${index}`} \n  //     style={style}\n  //     title={index}\n  //   ><div className='video-member'>{index}</div>}\n  //   </div>\n  //   })\n  //   return davi\n  // }\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"box-conferencia\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sala-conferencia\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AssentoMemorial, {\n    member: memorialInfo,\n    index: 0,\n    length: members.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(AssentoMeu, {\n    member: {\n      id: 111,\n      name: DISPLAY_NAME,\n      video: videoElement,\n      permissionDenied,\n      isAudioMuted,\n      isVideoMuted\n    },\n    index: 1,\n    length: members.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 11\n    }\n  }), members.map((member, i) => /*#__PURE__*/React.createElement(Assento, {\n    member: member,\n    index: i + 2,\n    length: members.length,\n    key: member.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 39\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"controles-conferencia\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    id: \"btnCustomMic\",\n    color: \"secondary\",\n    type: \"btn circle\",\n    action: () => toggleAudio(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 13\n    }\n  }, isAudioMuted ? /*#__PURE__*/React.createElement(IcoSemMicrofone, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 31\n    }\n  }) : /*#__PURE__*/React.createElement(IcoMicrofone, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 53\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    id: \"btnHangup\",\n    color: \"danger\",\n    type: \"btn circle\",\n    action: () => sairSala(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IcoTelefone, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    id: \"btnCustomCamera\",\n    color: \"secondary\",\n    type: \"btn circle\",\n    action: () => toggleVideo(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 13\n    }\n  }, isVideoMuted ? /*#__PURE__*/React.createElement(IcoSemCamera, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 31\n    }\n  }) : /*#__PURE__*/React.createElement(IcoCamera, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 50\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 11\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/daviribeiro/Desktop/projetos FDTE/projetos/transcender-jitsi/src/pages/celebracao/sala/sala.js"],"names":["React","useState","useEffect","useRef","useDispatch","useSelector","$","map","Button","IcoCamera","IcoMicrofone","IcoSemCamera","IcoSemMicrofone","IcoTelefone","Assento","AssentoMeu","AssentoMemorial","history","useParams","atualisaCampo","window","App","dispath","videoConferenciaState","state","celebracaoState","videoConferencia","paramsUrl","sala","target","name","value","error","setError","msgs","setMsgs","members","setMembers","remoteTracks","setRemoteTracks","permissionDenied","setPermissionDenied","isAudioMuted","setIsAudioMuted","isVideoMuted","setIsVideoMuted","videoElement","connection","conferenceRoom","ROOM_NAME","DISPLAY_NAME","nome","Math","floor","Date","now","memorialInfo","nomeHomenageado","data","dataNascimento","dataFalecimento","descricao","epitafio","img","JitsiMeetJS","config","initializeJitsiMeetJS","initializeConnection","serviceUrl","bosh","initOptions","disableAudioLevels","setLogLevel","logLevels","ERROR","init","current","JitsiConnection","setupConnectionListeners","addMsg","connect","addEventListener","events","CONNECTION_ESTABLISHED","handleConnectionEstablished","CONNECTION_FAILED","handleConnectionFailure","CONNECTION_DISCONNECTED","handleConnectionDisconnected","initConferenceRoom","setupJitsiConference","setupConferenceHandlers","setupErrorHandlers","setDisplayName","join","confOptions","openBridgeChannel","initJitsiConference","on","conference","CONFERENCE_JOINED","handleConferenceJoined","USER_JOINED","handleUserJoined","USER_LEFT","handleUserLeft","TRACK_ADDED","handleTrackAdded","TRACK_REMOVED","handleTrackRemoved","tracks","createLocalTracks","devices","resolution","length","i","getType","attach","addTrack","err","e","console","log","memberId","document","getElementById","remove","track","isLocal","prev","t","filter","p","getId","sjustListMember","mx","m","id","j","participants","getParticipantId","CONNECTION_ERROR","SETUP_FAILED","VIDEOBRIDGE_NOT_AVAILABLE","RESERVATION_ERROR","AUTHENTICATION_REQUIRED","JINGLE_FATAL_ERROR","PASSWORD_REQUIRED","FOCUS_DISCONNECTED","CONFERENCE_ERROR","CONFERENCE_FAILED","msg","prevMsgs","toggleAudio","getLocalTracks","forEach","isMuted","unmute","mute","toggleVideo","sairSala","disconnect","push","video","member"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport $, { map } from \"jquery\";\nimport { Button, IcoCamera, IcoMicrofone, IcoSemCamera, IcoSemMicrofone, IcoTelefone } from \"../../../components\";\nimport { Assento } from \"./assento\"\nimport { AssentoMeu } from \"./assentoMeu\";\nimport { AssentoMemorial } from \"./assentoMemorial\";\nimport { history } from \"../../../utils/helpers\";\nimport { useParams } from \"react-router-dom\";\nimport { atualisaCampo } from \"../redux/CelebracaoActions\";\n\nimport './sala.css'\n\n// Lib-jitsi-meet requires jquery as global object\nwindow.$ = $;\n\nfunction App() { \n  const dispath = useDispatch()\n  const videoConferenciaState = useSelector(state => state.celebracaoState.videoConferencia)\n\n  const paramsUrl = useParams()\n  useEffect(()=>{\n    if (paramsUrl.sala) {\n      const target = {target:{name: 'sala', value: paramsUrl.sala}}\n      dispath(atualisaCampo(target))\n    }\n  },[paramsUrl])\n\n  \n  const [error, setError] = useState(null);\n  const [msgs, setMsgs] = useState([]);\n  const [members, setMembers] = useState([]);\n  const [remoteTracks, setRemoteTracks] = useState([]);\n\n  const [permissionDenied, setPermissionDenied] = useState(null);\n  const [isAudioMuted, setIsAudioMuted] = useState(false);\n  const [isVideoMuted, setIsVideoMuted] = useState(false);\n  const videoElement = useRef(null);\n\n  const connection = useRef(null);\n  const conferenceRoom = useRef(null);\n\n\n  const ROOM_NAME = videoConferenciaState.sala;\n  const DISPLAY_NAME = videoConferenciaState.nome ? videoConferenciaState.nome : \"Participante - \" + Math.floor(Date.now() / 1000);\n\n  const memorialInfo = {\n    nome: videoConferenciaState.nomeHomenageado, \n    data: `${videoConferenciaState.dataNascimento} - ${videoConferenciaState.dataFalecimento} `, \n    descricao: videoConferenciaState.epitafio, \n    img: 'https://www.hojeemdia.com.br/polopoly_fs/1.648481.1534536791!/image/image.jpg_gen/derivatives/landscape_653/image.jpg'\n  };\n\n  useEffect(() => {\n    if (!window.JitsiMeetJS) {\n      setError(\n        \"JitsiMeetJS is not available. Please check if lib-jitsi-meet is included in index.html file\"\n      );\n      return;\n    }\n    if (!window.config) {\n      setError(\n        \"Video conference config is not available. Please check if config.js is included in index.html file\"\n      );\n      return;\n    }\n\n    const { JitsiMeetJS, config } = initializeJitsiMeetJS();\n    initializeConnection(JitsiMeetJS, config);\n    return;\n   \n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  \n  function initializeJitsiMeetJS() {\n    const { JitsiMeetJS, config } = window;\n    let serviceUrl = 'wss://meet.jit.si/xmpp-websocket' //config.websocket || config.bosh;\n    serviceUrl += `?room=${ROOM_NAME}`;\n    config.serviceUrl = config.bosh = serviceUrl;\n    const initOptions = {\n      disableAudioLevels: true,\n    };\n    // Jitsi will show logs as errors\n    JitsiMeetJS.setLogLevel(JitsiMeetJS.logLevels.ERROR);\n    JitsiMeetJS.init(initOptions);\n    return { JitsiMeetJS, config };\n  }\n  function initializeConnection(JitsiMeetJS, config) {\n    connection.current = new JitsiMeetJS.JitsiConnection(null, null, config);\n    setupConnectionListeners(JitsiMeetJS);\n    addMsg(\"Connecting to video conference server...\");\n    connection.current.connect();\n  }\n  function setupConnectionListeners(JitsiMeetJS) {\n    connection.current.addEventListener(\n      JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,\n      handleConnectionEstablished\n    );\n    connection.current.addEventListener(\n      JitsiMeetJS.events.connection.CONNECTION_FAILED,\n      handleConnectionFailure\n    );\n    connection.current.addEventListener(\n      JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED,\n      handleConnectionDisconnected\n    );\n  }\n\n  function handleConnectionEstablished() {\n    setMsgs([\"Connection successful\"]);\n    initConferenceRoom();\n  }\n  function initConferenceRoom() {\n    const { JitsiMeetJS } = window;\n    setupJitsiConference();\n    setupConferenceHandlers(JitsiMeetJS);\n    setupErrorHandlers(JitsiMeetJS);\n    setMsgs([`Joining conference room ${ROOM_NAME}`]);\n    conferenceRoom.current.setDisplayName(DISPLAY_NAME);\n    conferenceRoom.current.join();\n  }\n  function setupJitsiConference() {\n    const confOptions = {\n      openBridgeChannel: true,\n    };\n    conferenceRoom.current = connection.current.initJitsiConference(\n      ROOM_NAME,\n      confOptions\n    );\n  }\n  function setupConferenceHandlers(JitsiMeetJS) {\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.CONFERENCE_JOINED,\n      handleConferenceJoined\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.USER_JOINED,\n      handleUserJoined\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.USER_LEFT,\n      handleUserLeft\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.TRACK_ADDED,\n      handleTrackAdded\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.TRACK_REMOVED,\n      handleTrackRemoved\n    );\n  }\n  \n  async function handleConferenceJoined() {\n    setMsgs([`Joined conference room ${ROOM_NAME}`]);\n    const { JitsiMeetJS } = window;\n    try {\n      const tracks = await JitsiMeetJS.createLocalTracks({\n        devices: [\"audio\", \"video\"],\n        resolution: \"vga\",\n      });\n      setPermissionDenied(false);\n      if (tracks.length === 0) return;\n\n      for (let i = 0; i < tracks.length; i++) {\n        if (tracks[i].getType() === \"video\")\n          tracks[i].attach(videoElement.current);\n        conferenceRoom.current.addTrack(tracks[i]);\n      }\n    } catch (err) {\n      if (err.name === \"gum.not_found\") {\n        try {\n          const tracks = await JitsiMeetJS.createLocalTracks({\n            devices: [\"audio\"],\n          });\n          setPermissionDenied(false);\n          if (tracks.length === 0) return;\n          for (let i = 0; i < tracks.length; i++) {\n            if (tracks[i].getType() === \"video\")\n              tracks[i].attach(videoElement.current);\n            conferenceRoom.current.addTrack(tracks[i]);\n          }\n        } catch (e) {\n          console.log(e);\n        }\n      }\n      console.log(err);\n    }\n  }\n\n  function handleUserJoined(memberId) {\n    // if (members[memberId]) return;\n    // const displayName = conferenceRoom.current.getParticipantById(memberId)\n    //   ._displayName;\n    // createAndAddMember(memberId, displayName);\n  }\n  function handleUserLeft(memberId) {\n    console.log(\"[TRACKS BEFORE REMOVING]\", remoteTracks);\n    // let tracks = remoteTracks.filter((t) => {\n    //   console.log(t);\n    //   return t.getParticipantId() !== memberId;\n    // });\n    // console.log(\"[TRACKS AFTER REMOVING]\", tracks);\n    // setRemoteTracks(tracks);\n\n    document.getElementById(`member-${memberId}`).remove();\n    // removeMember(memberId);\n  }\n\n  function handleTrackAdded(track) {\n    if (track.isLocal()) return;\n    setRemoteTracks((prev) => [...prev, track]);\n  }\n  function handleTrackRemoved(track) {\n    setRemoteTracks((prev) => {\n      const t = prev.filter((p) => p.getId() !== track.getId());\n      return t;\n    });\n  }\n\n\n  const sjustListMember = (i, t) =>{\n    const mx = members.filter((m) => m.id === i)\n    \n    if (mx.length) {\n      const j = members.map((m) => m.id === i ? { ...m, [t.getType()]: t } : m)\n      setMembers( j )\n    } else{\n      const name = conferenceRoom.current.participants[i]['_displayName'] ?\n      conferenceRoom.current.participants[i]['_displayName'] : `Participante - ${i}`\n      setMembers( [ ...members, {id: i, name, [t.getType()]: t} ] )\n    }\n  }\n\n  useEffect(() => {\n    for (let i = 0; i < remoteTracks.length; i++) {\n      const track = remoteTracks[i];\n      const id = track.getParticipantId();\n\n      sjustListMember(id, track)\n    }\n  }, [remoteTracks]);\n\n  function setupErrorHandlers(JitsiMeetJS) {\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.CONNECTION_ERROR,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room connection error\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.SETUP_FAILED,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room set up failed\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.VIDEOBRIDGE_NOT_AVAILABLE,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room video bridge not available\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.RESERVATION_ERROR,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room reservation error\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.AUTHENTICATION_REQUIRED,\n      () => {\n        setError(\n          \"Conference room creation failed as authentication is required\"\n        );\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.JINGLE_FATAL_ERROR,\n      (err) => {\n        setMsgs([]);\n        setError(\"Conference room creation failed due to jingle error\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.PASSWORD_REQUIRED,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room join failed as password was required\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.FOCUS_DISCONNECTED,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room focus disconnected\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.CONFERENCE_ERROR,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room error\");\n      }\n    );\n    conferenceRoom.current.on(\n      JitsiMeetJS.events.conference.CONFERENCE_FAILED,\n      () => {\n        setMsgs([]);\n        setError(\"Conference room create/join failed\");\n      }\n    );\n  }\n  function handleConnectionFailure() {\n    setMsgs([\"Connection failure\"]);\n  }\n  function handleConnectionDisconnected() {\n    addMsg(\"Disconnected\");\n  }\n\n  // UI interactions and updates\n  function addMsg(msg) {\n    setMsgs((prevMsgs) => [...prevMsgs, msg]);\n  }\n\n  function toggleAudio() {\n    const tracks = conferenceRoom.current.getLocalTracks();\n    tracks.forEach((track) => {\n      if (track.getType() === \"audio\") {\n        setIsAudioMuted(!track.isMuted());\n        track.isMuted() ? track.unmute() : track.mute();\n      }\n    });\n  }\n  function toggleVideo() {\n    const tracks = conferenceRoom.current.getLocalTracks();\n    tracks.forEach((track) => {\n      if (track.getType() === \"video\") {\n        setIsVideoMuted(!track.isMuted());\n        track.isMuted() ? track.unmute() : track.mute();\n      }\n    });\n  }\n\n  const sairSala = () => {\n    connection.current.disconnect();\n    history.push('/sala')\n  }\n\n\n  // const membersTest = () =>{\n  //   const Assento = [0, 1, 2, 3, 4],\n  //   lengthAssento = Assento.length\n \n  //   const davi = Assento.map((i)=>{\n  //     const seatSize = getWidthForSeats(lengthAssento);\n  //     const disanceRatio = getDistanceRatioForSeats(lengthAssento);\n  //     let index = i \n  //     const angle = (360 / lengthAssento) * index;\n  //     const horizontal = Math.cos(angle * 2 * Math.PI / 360) * disanceRatio;\n  //     const vertical = Math.sin(angle * 2 * Math.PI / 360) * disanceRatio;\n      \n  // let style = { \n  //   width: seatSize, \n  //   height: seatSize, \n  //   top: `calc(50% - ${seatSize}px/2  + ${vertical}%)`, \n  //   left: `calc(50% - ${seatSize}px/2 + ${horizontal}%)`,\n  // }\n  //     return <div \n  //     className={'assento'} \n  //     id={`member-${index}`} \n  //     style={style}\n  //     title={index}\n  //   ><div className='video-member'>{index}</div>}\n  //   </div>\n\n  //   })\n\n  //   return davi\n  // }\n\n  return (\n    <div className=\"box-conferencia\">\n      <div className='sala-conferencia'>\n          <AssentoMemorial member={memorialInfo} index={0} length={members.length} />\n\n          <AssentoMeu member={{id: 111, name: DISPLAY_NAME, video: videoElement, permissionDenied, isAudioMuted, isVideoMuted}} index={1} length={members.length} />\n\n          {members.map((member, i) => <Assento member={member} index={i+2} length={members.length} key={member.id}  />) }\n\n          {/* {membersTest()} */}\n      </div>\n      \n      <div className='controles-conferencia'>\n          <div></div>\n          <div>\n            <Button  id='btnCustomMic' color='secondary' type='btn circle' action={()=> toggleAudio()}>\n              \n              {isAudioMuted ? <IcoSemMicrofone /> : <IcoMicrofone />}\n            </Button>\n            <Button  id='btnHangup' color='danger' type='btn circle' action={()=> sairSala()}>\n              <IcoTelefone />\n            </Button>\n            <Button  id='btnCustomCamera' color='secondary' type='btn circle' action={()=> toggleVideo()}>\n              \n              {isVideoMuted ? <IcoSemCamera /> : <IcoCamera />}\n            </Button>\n\n          </div>\n          <div></div>\n \n       </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}